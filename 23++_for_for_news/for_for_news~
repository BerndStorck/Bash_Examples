#! /usr/bin/bash
#
# for_for_news 1.0.0, 2023-05-16
#
# Quick And Dirty demonstration of a practical use of a for loop.
#
# Calls news about Linux via the programm ddgr, which gets search
# results from duckduckgo.com at the terminal, and translates the
# descriptional text of every result from English to German.
#
# Prerequisites / needed programs:
#
#  - ddgr
#  - trans
#  - reformat
#
# Bernd Storck, https://www.facebook.com/BStLinux/
#


if [ "$1" = "install" ]; then   # Package name may differ from program name.

  for i in apt aptitude apt-get
  do
    if command -v "$i" > /dev/null; then
      installer="$i"
      break
    fi
  done

  declare -A programs=( [ddgr]=ddgr [trans]=translate-shell [reformat]=reformat )
  for prog in ${!programs[@]}
  do
    if ! command -v $prog > /dev/null; then
      echo -e "\033[0;97mBen√∂tigtes Programm $prog wird installiert:\033[0m"
      sudo $installer -y install "${programs[$prog]}"
    fi
    echo      
  done
  exit 0
fi  
   
# Read parameters and set defaults, if no parameter is given:
[ -n "$1" ] && last_number="$1" || last_number=4
[ -z "$2" ] && searched="Linux news" || searched="$2"

for i in $(seq $last_number)
do
  
  # Headline and URL:
  article="$(ddgr --np -n "$last_number" -x "$searched" | grep -A30 "^ $i\." | grep -E -m1 -B30 '^$')"
  echo -e "\033[0;97m"
  head -n 2 <<< "$article"
  echo -e "\033[0m"
  
  # Save description and print:
  txt="$(tail -n +3 <<< "$article")"
  reformat -l 5 -w 80 <<< "$txt"
  
  # Translate and print description:
  echo -e "\033[0;93m"
  trans -brief en:de "$txt" | reformat -l 5 -w 80
  echo -e "\033[0m-------------"
  
done | less -r

echo -en "\033[0m" # color off 
exit 0
